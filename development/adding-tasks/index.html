<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Adding Tasks - TPO</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">TPO</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../overview/" class="nav-link">Overview</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Setup</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../setup/summary/" class="dropdown-item">Summary</a>
</li>
                                    
<li>
    <a href="../../setup/local-installation/" class="dropdown-item">Local Installation</a>
</li>
                                    
<li>
    <a href="../../setup/local-build/" class="dropdown-item">Local Build</a>
</li>
                                    
<li>
    <a href="../../setup/cloud-deployment/" class="dropdown-item">Cloud Deployment</a>
</li>
                                    
<li>
    <a href="../../setup/local-development/" class="dropdown-item">Local Development</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Usage</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../usage/cli/" class="dropdown-item">TPO Command Line Interface</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Configuration</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../usage/configuration/overview/" class="dropdown-item">Overview</a>
</li>
            
<li>
    <a href="../../usage/configuration/settings-file/" class="dropdown-item">Settings</a>
</li>
            
<li>
    <a href="../../usage/configuration/genome-support/" class="dropdown-item">Genome-Support</a>
</li>
            
<li>
    <a href="../../usage/configuration/bcl-barcodes/" class="dropdown-item">BCL-Barcodes</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Tasks</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../usage/tasks/overview/" class="dropdown-item">Overview</a>
</li>
            
<li>
    <a href="../../usage/tasks/analysis-tasks/" class="dropdown-item">Analysis Tasks</a>
</li>
            
<li>
    <a href="../../usage/tasks/development-tasks/" class="dropdown-item">Development Tasks</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Pipelines</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../usage/pipelines/overview/" class="dropdown-item">Overview</a>
</li>
            
<li>
    <a href="../../usage/pipelines/onco-seq/" class="dropdown-item">OncoSeq</a>
</li>
            
<li>
    <a href="../../usage/pipelines/wgs-wes/" class="dropdown-item">WGS+WES</a>
</li>
            
<li>
    <a href="../../usage/pipelines/shallow-wgs/" class="dropdown-item">Shallow WGS</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">R Packages</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../usage/r-packages/overview/" class="dropdown-item">Overview</a>
</li>
            
<li>
    <a href="../../usage/r-packages/tpolib/" class="dropdown-item">tpolib</a>
</li>
            
<li>
    <a href="../../usage/r-packages/codac/" class="dropdown-item">codac</a>
</li>
            
<li>
    <a href="../../usage/r-packages/cnvex/" class="dropdown-item">cnvex</a>
</li>
            
<li>
    <a href="../../usage/r-packages/carat/" class="dropdown-item">carat</a>
</li>
            
<li>
    <a href="../../usage/r-packages/caniq/" class="dropdown-item">caniq</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Shiny Apps</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../usage/shiny-apps/overview/" class="dropdown-item">Overview</a>
</li>
            
<li>
    <a href="../../usage/shiny-apps/curve/" class="dropdown-item">curve</a>
</li>
            
<li>
    <a href="../../usage/shiny-apps/cnvex-viewer/" class="dropdown-item">cnvex-viewer</a>
</li>
            
<li>
    <a href="../../usage/shiny-apps/structural-viewer.md" class="dropdown-item">structural-viewer</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Output</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../output/somatic-variants/" class="dropdown-item">Somatic Variants</a>
</li>
                                    
<li>
    <a href="../../output/silos-and-vaults/" class="dropdown-item">Silos and Vaults</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Development</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../architecture/" class="dropdown-item">Architecture</a>
</li>
                                    
<li>
    <a href="../debugging/" class="dropdown-item">Debugging</a>
</li>
                                    
<li>
    <a href="../repository/" class="dropdown-item">Repository</a>
</li>
                                    
<li>
    <a href="../updating-references/" class="dropdown-item">Updating References</a>
</li>
                                    
<li>
    <a href="../updating-ensembl/" class="dropdown-item">Updating Ensembl</a>
</li>
                                    
<li>
    <a href="../updating-panel-of-normals/" class="dropdown-item">Updating Panel-of-Normals</a>
</li>
                                    
<li>
    <a href="../unit-testing/" class="dropdown-item">Unit Testing</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Adding Tasks</a>
</li>
                                    
<li>
    <a href="../adding-capture-panel/" class="dropdown-item">Adding Capture Panel</a>
</li>
                                    
<li>
    <a href="../use-tpo-in-local-mode/" class="dropdown-item">Use TPO in Local Mode</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Notes</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../notes/overview/" class="dropdown-item">Overview</a>
</li>
                                    
<li>
    <a href="../../notes/circos/" class="dropdown-item">circos</a>
</li>
                                    
<li>
    <a href="../../notes/examples/" class="dropdown-item">Examples</a>
</li>
                                    
<li>
    <a href="../../notes/misc/" class="dropdown-item">Misc</a>
</li>
                                    
<li>
    <a href="../../notes/integrative-analysis/" class="dropdown-item">Integrative Analysis</a>
</li>
                                    
<li>
    <a href="../../notes/use-cases/" class="dropdown-item">Use Cases</a>
</li>
                                    
<li>
    <a href="../../notes/variant-and-feature-manual-review/" class="dropdown-item">Variant & Feature Manual Review</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../unit-testing/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../adding-capture-panel/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#adding-pipeline-scripts" class="nav-link">Adding pipeline scripts</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#adding-new-software" class="nav-link">Adding new software</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>Adding new pipelines to TPO involves two steps: 
* Adding the pipeline scripts
* Adding software (binaries, etc.) needed for the pipelines to run</p>
<h2 id="adding-pipeline-scripts">Adding pipeline scripts</h2>
<p>TPO pipelines consist of (at least) two components:
* A gcp script (<code>*_gcp.sh</code>) which launches the Google Cloud instance and handles input and output of files to the cloud buckets
* A docker script (<code>*_docker.sh</code>) which is called by a docker container inside of the GCP instance launched above. This script does the "work" of whatever bioinformatics pipeline is in use (i.e. a call to <code>samtools</code> will be inside of this script).</p>
<p>Updates to the scripts done on your local machine need to be made available to the gcp instances where they are needed. This is accomplished via the <code>code</code> docker image. After changes are made, consider a version bump, then <code>moke images_build -image "code"</code> to update the docker locally and <code>moke images_push</code> to copy the code image to GCR. By default the <code>images_build</code> task will tar up the local <code>tpo</code> directory as is, so any changes (even those not staged, committed, etc.) will be made live. </p>
<h2 id="adding-new-software">Adding new software</h2>
<p>Software can be made available to TPO scripts in several ways. Deciding which to use is somewhat arbitrary, but should depend on whether the software will be used by multiple pipelines, or just one. The options are 
* Add to <code>root</code>
  * This will be available to the gcp instance and any docker images which mount <code>/tpo:/tpo</code>
* Add to <code>base</code> docker image
  * This will be available to <code>base</code> and all docker images that inherit from it
* Add to a specific docker image (i.e. <code>cords</code>)
  * This will only be available to that image</p>
<p>The procedure for adding new files to <code>root</code> involves the following 
* <code>moke artifacts_pull</code> to download the artifacts to a local directory (specified in mokefile)
* wait for pull
* copy binary to artifacts/input
* update appropriate build script (i.e. <code>base/root/build_tools.sh</code>)
* Add references if needed
* <code>moke artifacts_push</code> to rsync changes to the bucket
* Bump version (<code>ROOT_VER</code>) (<strong><em>check that no image with a conflicting name/version is present on GCP before proceeding</em></strong>)
* <code>moke gcp_root_build</code> to launch a gcp instance to build the <code>ROOT</code> directory with the new version</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
